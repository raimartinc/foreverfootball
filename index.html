<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="Explore football teams—stats, logos, uniforms, and maps!">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://unpkg.com 'unsafe-inline' 'unsafe-eval'; style-src 'self' https://unpkg.com 'unsafe-inline'; img-src 'self' https://* data:; connect-src 'self' https://*.tile.openstreetmap.org">
    <title>Forever Football</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>
    <div class="container">
        <div class="main">
            <h1>Forever Football</h1>
            <div class="tabs">
                <button class="tab-btn active" data-tab="teams">Teams</button>
                <button class="tab-btn" data-tab="map">Map</button>
            </div>
            <div id="teams" class="tab-content active">
                <div id="team-select">
                    <select id="country" autocomplete="off"><option value="">Select Country</option></select>
                    <select id="city" autocomplete="off"><option value="">Select City</option></select>
                    <select id="team" autocomplete="off"><option value="">Select Team</option></select>
                </div>
                <div id="team-details"></div>
            </div>
            <div id="map" class="tab-content"></div>
        </div>
    </div>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="teams.js"></script>
    <style>
        body { 
            margin: 0; 
            font-family: Arial; 
            background: url('images/footbg.jpg') no-repeat center center fixed; 
            background-size: cover; 
        }
        .container { display: flex; height: 100vh; }
        .main { flex: 1; padding: 20px; background: rgba(255, 255, 255, 0.8); }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab-btn { padding: 10px 20px; background: #FF4500; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .tab-btn.active { background: #FFA500; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        #team-select { margin-bottom: 20px; }
        select { padding: 10px; font-size: 16px; margin-right: 10px; }
        #team-details { font-size: 18px; }
        #map { height: 400px; width: 80%; margin: 0 auto; background: #ddd; }
    </style>
    <script>
        console.log('Script started');

        try {
            document.addEventListener('DOMContentLoaded', function() {
                console.log('DOM loaded');

                // Tabs
                console.log('Setting up tabs');
                const tabs = document.querySelectorAll('.tab-btn');
                tabs.forEach(tab => {
                    tab.addEventListener('click', function() {
                        console.log('Tab clicked:', this.dataset.tab);
                        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                        document.getElementById(this.dataset.tab).classList.add('active');
                        this.classList.add('active');
                        if (this.dataset.tab === 'map') initMap();
                    });
                });

                // Map
                let mapInitialized = false;
                function initMap() {
                    console.log('Map init called');
                    if (!mapInitialized && typeof L !== 'undefined') {
                        const map = L.map('map').setView([20, 0], 2);
                        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '© OpenStreetMap' }).addTo(map);
                        teams.forEach(team => {
                            L.marker([team.lat, team.lon]).addTo(map)
                                .bindPopup(`${team.name} (${team.country})<br>${team.league}<br>${team.stadium}`);
                        });
                        mapInitialized = true;
                    }
                }

                // Dropdowns
                console.log('Teams check:', typeof teams);
                if (typeof teams === 'undefined') {
                    console.error('teams.js not loaded!');
                    return;
                }

                console.log('Teams count:', teams.length);
                const countrySelect = document.getElementById('country');
                const citySelect = document.getElementById('city');
                const teamSelect = document.getElementById('team');
                const details = document.getElementById('team-details');

                console.log('Populating countries');
                const countries = [...new Set(teams.map(t => t.country))].sort();
                console.log('Countries:', countries);
                countries.forEach(country => {
                    const option = document.createElement('option');
                    option.value = country;
                    option.textContent = country;
                    countrySelect.appendChild(option);
                });

                countrySelect.addEventListener('change', function() {
                    console.log('Country changed:', this.value);
                    citySelect.innerHTML = '<option value="">Select City</option>';
                    teamSelect.innerHTML = '<option value="">Select Team</option>';
                    details.innerHTML = '';
                    if (this.value) {
                        const cities = [...new Set(teams.filter(t => t.country === this.value).map(t => t.city))].sort();
                        console.log('Cities:', cities);
                        cities.forEach(city => {
                            const option = document.createElement('option');
                            option.value = city;
                            option.textContent = city;
                            citySelect.appendChild(option);
                        });
                    }
                });

                citySelect.addEventListener('change', function() {
                    console.log('City changed:', this.value);
                    teamSelect.innerHTML = '<option value="">Select Team</option>';
                    details.innerHTML = '';
                    if (this.value) {
                        const teamList = teams.filter(t => t.country === countrySelect.value && t.city === this.value).sort((a, b) => a.name.localeCompare(b.name));
                        console.log('Teams:', teamList.map(t => t.name));
                        teamList.forEach(team => {
                            const option = document.createElement('option');
                            option.value = team.name;
                            option.textContent = team.name;
                            teamSelect.appendChild(option);
                        });
                    }
                });

                teamSelect.addEventListener('change', function() {
                    console.log('Team changed:', this.value);
                    details.innerHTML = '';
                    if (this.value) {
                        const team = teams.find(t => t.name === this.value);
                        details.innerHTML = `
                            <div><strong>Name:</strong> ${team.name} ${team.active ? '' : '(Defunct)'}</div>
                            <div><strong>Country:</strong> ${team.country}</div>
                            <div><strong>League:</strong> ${team.league}</div>
                            <div><strong>City:</strong> ${team.city}</div>
                            <div><strong>Founded:</strong> ${team.founded}</div>
                            <div><strong>Stadium:</strong> ${team.stadium}</div>
                            <div><strong>Trophies:</strong> ${team.trophies}</div>
                            <div><strong>Must know fact:</strong> ${team.mustKnowFact}</div>
                            <img src="${team.logo || 'https://via.placeholder.com/200?text=Logo'}" alt="${team.name} Logo" style="max-width: 200px;">
                            <img src="${team.uniform || 'https://via.placeholder.com/200?text=Uniform'}" alt="${team.name} Uniform" style="max-width: 200px;">
                        `;
                    }
                });
            });
        } catch (e) {
            console.error('Script error:', e);
        }
    </script>
</body>
</html>